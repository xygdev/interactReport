(function($){$.fn.pageListener=function(){$('input[data-pagetype]').off('click');$('button[data-pagetype]').off('click');$('a[data-pagetype]').off('click');$('i[data-pagetype]').off('click');$('input[data-pagetype]').on('click',function(e){$(this).page($(this).data())});$('button[data-pagetype]').on('click',function(e){$(this).page($(this).data())});$('a[data-pagetype]').on('click',function(e){e.preventDefault();$(this).page($(this).data())});$('i[data-pagetype]').on('click',function(e){$(this).page($(this).data())})}$().pageListener();$.fn.page=function(options){var defaults={pagesetting:'{"loading":"","firstpage":"","lastpage":"","prevpage":"","nextpage":"","setpagesize":"","closebutton":"","pagesize":"","pageno":"","pagerow":"","tablename":""}'}var options=$.extend({},defaults,options);jQuery.global={main:function(){jQuery.json.setQueryParam();if(options.pagetype=='lastpage'){param=param+'&pageSize='+pageSize+'&pageNo='+pageNo+'&goLastPage=true'}else{param=param+'&pageSize='+pageSize+'&pageNo='+pageNo+'&goLastPage=false'}queryurl=options.queryurl;if(queryurl==undefined){queryurl=$(options.pagesetting.urltd).val()}orderby=$('#order_para').val();param=param+'&orderby='+orderby;$.ajax({async:true,type:'post',data:param,url:queryurl,dataType:'json',success:function(data){$(options.pagesetting.tablename+' td[data-column="db"]').html('');jQuery.json.getMSG(data);$(options.pagesetting.tablename+' tr').css('display','');if(parseInt(data.pageMinRow)!=0){jsontype=options.jsontype;if(jsontype==undefined){jsontype=$(options.pagesetting.typetd).val()}jQuery.json.getContent(data,jsontype);for(j=0;j<=(pageSize-(pageMaxRow-pageMinRow+1));j++){$(options.pagesetting.tablename+' tr:eq('+(pageSize-j+1)+')').css('display','none')}if(firstPageFlag=='true'){$(options.pagesetting.prevpage).css('display','none');$(options.pagesetting.firstpage).css('display','none')}else{$(options.pagesetting.prevpage).css('display','');$(options.pagesetting.firstpage).css('display','')}if(lastPageFlag=='true'){$(options.pagesetting.lastpage).css('display','none');$(options.pagesetting.nextpage).css('display','none')}else{$(options.pagesetting.lastpage).css('display','');$(options.pagesetting.nextpage).css('display','')}if(pageMinRow!=pageMaxRow){$(options.pagesetting.pagerow).text(pageMinRow+'-'+pageMaxRow)}else{$(options.pagesetting.pagerow).text(pageMaxRow)}if(options.pagetype=='setpagesize'){$(options.pagesetting.pageno).val(1);$(options.pagesetting.closebutton).click()}else if(options.pagetype=='lastpage'){$(options.pagesetting.pageno).val(parseInt(totalPages))}else{$(options.pagesetting.pageno).val(pageNo)}}else{if(options.pagetype=='nextpage'){alert("当前页无数据,即将自动跳转到最后一页");$(options.pagesetting.lastpage).click()}else if(options.pagetype=='refresh'){alert("当前页无数据,即将自动跳转到最后一页");$(options.pagesetting.lastpage).click()}}$(options.pagesetting.loading).hide()},error:function(){if(options.pagetype=='lastpage'){$(options.tablename+' td').html('');alert("当前页无数据");$(options.pagesetting.pagerow).text('');$(options.pagesetting.loading).hide()}else{alert("获取Json数据失败")}}})}}return this.each(function(){$(options.pagesetting.loading).show();pageSize=parseInt($(options.pagesetting.pagesize).val());if(options.pagetype=='refresh'){pageNo=parseInt($(options.pagesetting.pageno).val());$('td[data-column="db"]',$('tr:eq(1)')).html('');blank_tr=$('tr:eq(1)',$(options.pagesetting.tablename));$('td',$(options.pagesetting.tablename)).parent().remove();for(j=1;j<=pageSize;j++){$('tr:eq(0)',$(options.pagesetting.tablename)).parent().append(blank_tr.clone())}jQuery.global.main()}else if(options.pagetype=='firstpage'){pageNo=parseInt(1);jQuery.global.main()}else if(options.pagetype=='lastpage'){pageNo=parseInt($(options.pagesetting.pageno).val())+1;jQuery.global.main()}else if(options.pagetype=='nextpage'){pageNo=parseInt($(options.pagesetting.pageno).val())+1;jQuery.global.main()}else if(options.pagetype=='prevpage'){pageNo=parseInt($(options.pagesetting.pageno).val())-1;jQuery.global.main()}else if(options.pagetype=='setpagesize'){pageSize=parseInt($(this).text());$('i',$(options.pagesetting.setpagesize)).css('visibility','hidden');$('i',$(this)).css('visibility','visible');$(options.pagesetting.pagesize).attr('value',pageSize);pageNo=parseInt(1);linenum=($(options.pagesetting.tablename+' tr').length-1);for(i=1;i<linenum;i++){$('tr:eq(1)',$(options.pagesetting.tablename)).remove()}$('td[data-column="db"]',$('tr:eq(1)')).html('');blank_tr=$('tr:eq(1)',$(options.pagesetting.tablename));for(j=1;j<pageSize;j++){$('tr:eq(1)',$(options.pagesetting.tablename)).parent().append(blank_tr.clone())}jQuery.global.main()}})}})(jQuery);
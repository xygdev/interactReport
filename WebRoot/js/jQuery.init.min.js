(function($){options={}var defaults={userid:'#user_id',interactcode:'#interact_code',orderpara:'#order_para',headerid:'#header_id',pagesize:'#page_size',tableid:'#tb',refresh:'#refresh',url:'getDefaultIRR.do'};var options=$.extend({},defaults,options);user_id=$(options.userid).val();interact_code=$(options.interactcode).val();param='user_id='+user_id+'&interact_code='+interact_code;$.ajax({type:'post',data:param,url:options.url,dataType:'json',success:function(data){if(data.EXISTS=='Y'){$(options.orderpara).val(data.jsonRoot.ORDER_BY);$(options.headerid).val(data.jsonRoot.HEADER_ID);$(options.pagesize).val(data.jsonRoot.PAGE_SIZE);$(options.tableid+' th').css('display','none');$(options.tableid+' td').css('display','none');linenum=$(options.tableid+' tr').length-1;setnum=data.jsonRoot.SEQ.length;data.jsonRoot.SEQ.reverse();for(i=0;i<setnum;i++){if(data.jsonRoot.SEQ[i].COLUMN_NAME!=null){row=$('.'+data.jsonRoot.SEQ[i].COLUMN_NAME);rowindex=row.index();$('.'+data.jsonRoot.SEQ[i].COLUMN_NAME).css('display','');if(rowindex!=0){$(options.tableid+' th:eq('+rowindex+')').insertBefore($(options.tableid+' th:eq(0)'));for(j=0;j<=linenum;j++){$('td:eq('+rowindex+')',$(options.tableid+' tr:eq('+j+')')).insertBefore($('td:eq(0)',$(options.tableid+' tr:eq('+j+')')))}}else{$(options.tableid+' th:eq('+rowindex+')').insertBefore($(options.tableid+' th:eq(1)'));for(j=0;j<=linenum;j++){$('td:eq('+rowindex+')',$(options.tableid+' tr:eq('+j+')')).insertBefore($('td:eq(1)',$(options.tableid+' tr:eq('+j+')')))}}}}$(options.refresh).click()}else{$(options.refresh).click()}},error:function(){alert("获取Json数据失败")}});$.fn.configListener=function(){$('a[data-config]').on('click',function(e){e.preventDefault();$(this).config($(this).data())});$('button[data-config]').on('click',function(){$(this).config($(this).data())})}$().configListener();$.fn.config=function(options){var defaults={userid:'#user_id',interactcode:'#interact_code',interactname:'#define_name',interactdesc:'#define_desc',orderpara:'#order_para',headerid:'#header_id',pagesize:'#page_size',tableid:'#tb',configid:'#config',refresh:'#refresh',setframe:'#setting',initurl:'getUserIRR.do',saveurl:'getSaveData.do',loadurl:'getIRR.do',publicflag:'#public_flag',defaultflag:'#default_flag',autoflag:'#autoquery_flag'}var options=$.extend({},defaults,options);return this.each(function(){configType=options.config;interact_code=$(options.interactcode).val();user_id=$(options.userid).val();header_id=$(options.headerid).val();if(configType=='init'){$(options.setframe).css('visibility','hidden');$(options.interactname).val('');$(options.interactdesc).val('');param='interact_code='+interact_code+'&user_id='+user_id;$.ajax({type:'post',data:param,url:options.initurl,dataType:'json',success:function(data){$(options.configid+' select').html('');loadingindex=data.jsonRoot.length;for(i=0;i<loadingindex;i++){name=data.jsonRoot[i].USER_INTERACT_NAME;value=data.jsonRoot[i].HEADER_ID;$(options.configid+' select').append('<option value="'+value+'" >'+name+'</option>')}$(options.configid+' option[value="'+header_id+'"]').prop('selected',true)},error:function(){alert("获取json数据错误")}})}else if(configType=='save'){user_interact_name=$(options.interactname).val();order_by=$(options.orderpara).val();page_size=$(options.pagesize).val();if(user_interact_name==''){alert('自定义名称不能为空');return}description=$(options.interactdesc).val();seq=new Array();count=$(options.tableid+' th').length-1;for(i=0;i<count;i++){if($(options.tableid+' th:eq('+i+')').css('display')!='none'){seq[i]=$(options.tableid+' th:eq('+i+')').attr('class')}}if($(options.publicflag).prop("checked")==true){public_flag='Y'}else{public_flag='N'}if($(options.defaultflag).prop("checked")==true){default_flag='Y'}else{default_flag='N'}if($(options.autoflag).prop("checked")==true){autoquery_flag='Y'}else{autoquery_flag='N'}param='interact_code='+interact_code+'&user_id='+user_id+'&user_interact_name='+user_interact_name+'&order_by='+order_by+'&page_size='+page_size+'&description='+description+'&seq='+seq+'&public_flag='+public_flag+'&default_flag='+default_flag+'&autoquery_flag='+autoquery_flag;$.ajax({type:'post',data:param,url:options.saveurl,dataType:'json',success:function(data){alert("保存成功");$(options.configid+' .close-reveal-modal').click()},error:function(){alert("未知错误")}})}else if(configType=='load'){header_id=$(options.configid+' option:selected').val()if(header_id=='blank'){alert('载入模板不能为空，请重新选择！');return}param='header_id='+header_id;$.ajax({type:'post',data:param,url:options.loadurl,dataType:'json',success:function(data){if(data.EXISTS=='Y'){$(options.orderpara).val(data.jsonRoot.ORDER_BY);$(options.headerid).val(data.jsonRoot.HEADER_ID);$(options.pagesize).val(data.jsonRoot.PAGE_SIZE);$(options.setframe+' i[data-value]').css('visibility','hidden');$(options.setframe+' i[data-value="'+data.jsonRoot.PAGE_SIZE+'"]').css('visibility','visible');$(options.tableid+' th').css('display','none');$(options.tableid+' td').css('display','none');linenum=$(options.tableid+' tr').length-1;setnum=data.jsonRoot.SEQ.length;data.jsonRoot.SEQ.reverse();for(i=0;i<setnum;i++){if(data.jsonRoot.SEQ[i].COLUMN_NAME!=null){row=$('.'+data.jsonRoot.SEQ[i].COLUMN_NAME);rowindex=row.index();$('.'+data.jsonRoot.SEQ[i].COLUMN_NAME).css('display','');if(rowindex!=0){$(options.tableid+' th:eq('+rowindex+')').insertBefore($(options.tableid+' th:eq(0)'));for(j=0;j<=linenum;j++){$('td:eq('+rowindex+')',$(options.tableid+' tr:eq('+j+')')).insertBefore($('td:eq(0)',$(options.tableid+' tr:eq('+j+')')))}}else{$(options.tableid+' th:eq('+rowindex+')').insertBefore($(options.tableid+' th:eq(1)'));for(j=0;j<=linenum;j++){$('td:eq('+rowindex+')',$(options.tableid+' tr:eq('+j+')')).insertBefore($('td:eq(1)',$(options.tableid+' tr:eq('+j+')')))}}}}$(options.refresh).click();alert("加载成功");$(options.configid+' .close-reveal-modal').click()}else{}},error:function(){alert("获取Json数据失败")}})}else{alert('获取json数据失败，请联系IT部门')}})}})(jQuery);
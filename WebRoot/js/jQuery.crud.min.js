(function($){$.fn.crudListener=function(){$('input[data-crudtype]').off('click');$('button[data-crudtype]').off('click');$('a[data-crudtype]').off('click');$('i[data-crudtype]').off('click');$('input[data-crudtype]').on('click',function(e){$(this).crud($(this).data())});$('button[data-crudtype]').on('click',function(e){$(this).crud($(this).data())});$('a[data-crudtype]').on('click',function(e){e.preventDefault();$(this).crud($(this).data())});$('i[data-crudtype]').on('click',function(e){$(this).crud($(this).data())})}$.fn.crud=function(options){var defaults={crudsetting:'{"loading":"","refresh":"","firstpage":"","lastpage":"","prevpage":"","nextpage":"","setpagesize":"","pagesize":"","pageno":"","pagerow":"","delmsg":"","tablename":"","lovid":"","urltd":"","typetd":""}'}var options=$.extend({},defaults,options);jQuery.global={pageFlag:function(firstPageFlag,lastPageFlag){if(firstPageFlag=='true'){$(options.crudsetting.prevpage).css('display','none');$(options.crudsetting.firstpage).css('display','none')}else{$(options.crudsetting.prevpage).css('display','');$(options.crudsetting.firstpage).css('display','')}if(lastPageFlag=='true'){$(options.crudsetting.lastpage).css('display','none');$(options.crudsetting.nextpage).css('display','none')}else{$(options.crudsetting.lastpage).css('display','');$(options.crudsetting.nextpage).css('display','')}}}return this.each(function(){if(options.crudtype=='del'){pageSize=parseInt($(options.crudsetting.pagesize).val());tr=$(this).parent().parent();name=tr.children(options.crudsetting.delmsg).text();result=confirm('是否要删除用户('+name+')?');if(result==true){$(options.crudsetting.loading).show();pageNo=parseInt($(options.crudsetting.pageno).val());param='pageSize='+pageSize+'&pageNo='+pageNo+'&'+options.delparam[0]+'='+tr.children(options.delparam[1]).text();$.ajax({type:'post',data:param,url:options.delurl,dataType:'json',success:function(data){$(options.crudsetting.refresh).click()},error:function(){alert("获取Json数据失败")}});return}else{result=null}}else if(options.crudtype=='pre-update'){$(options.crudsetting.loading).show();tr=$(this).parent().parent();param=options.updateparam[0]+'='+tr.children(options.updateparam[1]).text();$.ajax({type:'post',data:param,url:options.preupdateurl,dataType:'json',success:function(data){jQuery.json.getUpdateJSON(data);$(options.crudsetting.loading).hide()},error:function(){alert("获取Json数据失败")}})}else if(options.crudtype=='update'){jQuery.json.setUpdateParam();pageSize=parseInt($(options.crudsetting.pagesize).val());pageNo=parseInt($(options.crudsetting.pageno).val());param=options.updateparam[0]+'='+$(options.updateparam[1]).val()+'&'+param;$.ajax({type:'post',data:param,url:options.updateurl,dataType:'text',success:function(data){$('.'+options.dismissmodalclass).click();$(options.crudsetting.refresh).click()},error:function(){alert("获取数据失败")}})}else if(options.crudtype=='query'){jQuery.json.setQueryParam();pageSize=parseInt($(options.crudsetting.pagesize).val());pageNo=parseInt(1);$(options.crudsetting.pageno).val(pageNo)param=param+'&pageSize='+pageSize+'&pageNo='+pageNo;queryurl=$(options.crudsetting.urltd).val();$.ajax({type:'post',data:param,url:queryurl,dataType:'json',success:function(data){$(options.crudsetting.tablename+' td').html('');jQuery.json.getMSG(data);$(options.crudsetting.tablename+' tr').css('display','');jQuery.json.getContent(data,$(options.crudsetting.typetd).val());for(j=0;j<=(pageSize-(pageMaxRow-pageMinRow+1));j++){$(options.crudsetting.tablename+' tr:eq('+(pageSize-j+1)+')').css('display','none')}jQuery.global.pageFlag(firstPageFlag,lastPageFlag);width='-'+parseInt($(options.crudsetting.lovid).css('width'))/2+'px';$(options.crudsetting.lovid).css('margin-left',width)},error:function(){alert("获取Json数据失败")}})}})}})(jQuery);